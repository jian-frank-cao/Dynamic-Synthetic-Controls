getwd
getwd()
setwd("/Users/jiancao/Documents/GitHub/Dynamic-Synthetic-Controls")
getwd()
## Setup -----------------------------------------------------------------------
library(checkpoint)
checkpoint("2022-04-01")
library(parallel)
library(tidyverse)
source("./R/utility/misc.R")
source("./R/utility/TFDTW.R")
source("./R/utility/synth.R")
source("./R/utility/implement.R")
source("./R/utility/grid.search.R")
set.seed(20220407)
## Basque Terrorism Data -------------------------------------------------------
data(basque, package = "Synth")
data = basque
colnames(data)[1:4] = c("id", "unit", "time", "value")
data = data %>% mutate(invest_ratio = invest/value,
value_raw = value)
# rescale
df.rescale = data %>%
filter(time <= 1970) %>%
group_by(unit) %>%
summarise(value.min = min(value),
value.max = max(value)) %>%
ungroup()
mean.diff = mean(df.rescale$value.max - df.rescale$value.min)
df.rescale = df.rescale %>%
mutate(
multiplier = mean.diff/(value.max - value.min)
)
data = left_join(data, df.rescale, by = "unit")
data = data %>%
mutate(
value.bak = value_raw,
value_raw = (value_raw - value.min)*multiplier,
value = value_raw
)
# data list
data.list = list(list(target = "Basque Country (Pais Vasco)",
data = data))
ids = data$id %>%
unique
for (i in ids) {
data.temp = data %>% filter(!(id %in% c(i, 17)))
data.list = c(data.list,
list(list(target = data.temp$unit[1],
data = data.temp)))
}
select2 = combn(setdiff(ids, 17), 2, simplify = TRUE)[,1:100]
for (i in 1:ncol(select2)) {
data.temp = data %>% filter(!(id %in% c(select2[, i], 17)))
data.list = c(data.list,
list(list(target = data.temp$unit[1],
data = data.temp)))
}
