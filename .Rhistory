View(results)
View(results[["27"]][["mse"]])
args = commandArgs(trailingOnly=TRUE)
library(checkpoint)
checkpoint("2022-04-01")
library(parallel)
n.cores = detectCores()
library(tidyverse)
library(furrr)
plan(multisession, workers = n.cores - 1)
options(future.rng.onMisuse="ignore")
options(stringsAsFactors = FALSE)
source("./R/utility/misc.R")
source("./R/utility/TFDTW.R")
source("./R/utility/synth.R")
source("./R/utility/implement.R")
source("./R/utility/grid.search.R")
set.seed(20220407)
## Results ---------------------------------------------------------------------
folder = "./data/bond/"
file.list = as.list(list.files(folder))
a = readRDS(paste0(folder, file.list[[1]]))
View(a)
View(a[["1"]][["mse"]])
file_list[[1]]
file.list[[1]]
library(checkpoint)
checkpoint("2022-04-01")
library(parallel)
n.cores = detectCores()
library(tidyverse)
library(furrr)
plan(multisession, workers = n.cores - 1)
options(future.rng.onMisuse="ignore")
options(stringsAsFactors = FALSE)
source("./R/utility/misc.R")
source("./R/utility/TFDTW.R")
source("./R/utility/synth.R")
source("./R/utility/implement.R")
source("./R/utility/grid.search.R")
set.seed(20220407)
## Results ---------------------------------------------------------------------
folder = "./data/bond/"
file.list = as.list(list.files(folder))
file_name = file.list[[1]]
file_name
library(checkpoint)
checkpoint("2022-04-01")
library(parallel)
n.cores = detectCores()
library(tidyverse)
library(furrr)
plan(multisession, workers = n.cores - 1)
options(future.rng.onMisuse="ignore")
options(stringsAsFactors = FALSE)
source("./R/utility/misc.R")
source("./R/utility/TFDTW.R")
source("./R/utility/synth.R")
source("./R/utility/implement.R")
source("./R/utility/grid.search.R")
set.seed(20220407)
## Results ---------------------------------------------------------------------
folder = "./data/bond/"
file.list = as.list(list.files(folder))
file_name = file.list[[1]]
file_name
## Results ---------------------------------------------------------------------
folder = "./data/bond/"
file.list = list.files(folder)
file= file_name
file
strsplit(file, ".")
?strsplit
strsplit(file, "[.]")
strsplit(strsplit(file, "[.]")[1], "_")[2]
strsplit(file, "[.]")[1]
strsplit(file, "[.]")[[1]]
strsplit(file, "[.]")[[1]][1]
strsplit(strsplit(file, "[.]")[[1]][1], "_")[[1]][2]
df = readRDS(paste0(folder, file))
as.list(1:length(df))
id = 1
item = df[[1]]
View(item)
mse = future_map2(
as.list(1:length(df)),
df,
~{
id = .x
item = .y
mse$id = id
mse
}
) %>%
do.call("rbind", .)
mse = future_map2(
as.list(1:length(df)),
df,
~{
id = .x
item = .y
item$mse$id = id
item$mse
}
) %>%
do.call("rbind", .)
View(mse)
results = NULL
for (file in file.list) {
print(file)
df = readRDS(paste0(folder, file))
mse = future_map2(
as.list(1:length(df)),
df,
~{
id = .x
item = .y
item$mse$id = id
item$mse
}
) %>%
do.call("rbind", .)
mse$file = file
results[[file]] = mse
}
file
df = readRDS(paste0(folder, file))
file.list
for (file in file.list[81:100]) {
print(file)
df = readRDS(paste0(folder, file))
mse = future_map2(
as.list(1:length(df)),
df,
~{
id = .x
item = .y
item$mse$id = id
item$mse
}
) %>%
do.call("rbind", .)
mse$file = file
results[[file]] = mse
}
View(results)
View(results[["bond_100.Rds"]])
View(results[["bond_103.Rds"]])
results2 = results %>%
do.call("rbind", .)
View(results2)
results2 = results %>%
do.call("rbind", .) %>%
`rownames<-`(NULL)
View(results2)
results = results %>%
do.call("rbind", .) %>%
`rownames<-`(NULL)
mse = results %>%
filter(unit == "IBCI.DE") %>%
group_by(file) %>%
filter(mse.preT.TFDTW == min(mse.preT.TFDTW))
View(mse)
mse = results %>%
filter(unit == "IBCI.DE") %>%
group_by(file) %>%
filter(mse.preT.TFDTW == min(mse.preT.TFDTW)) %>%
filter(id == min(id))
View(mse)
data = readRDS("./data/bond.Rds")
data = reshape2::melt(data, id.vars = 1)
data_monthly = data %>%
mutate(date = as.Date(date),
month = format(date, "%Y-%m"),
unit = as.character(variable),
id = as.numeric(variable)) %>%
group_by(id, unit, month) %>%
summarise(value = mean(value, na.rm = T)) %>%
mutate(time = 1:155,
value_raw = value) %>%
ungroup() %>%
select(c("id", "unit", "time", "value", "value_raw", "month")) %>%
data.frame(.)
View(data)
View(data_monthly)
data %>%
ggplot(aes(x = time, y = value, group = unit))
data %>%
ggplot(aes(x = time, y = value, group = unit)) %>%
geom_line()
data %>%
ggplot(aes(x = time, y = value, group = unit)) +
geom_line()
data_monthly %>%
ggplot(aes(x = time, y = value, group = unit)) +
geom_line()
data_monthly %>%
ggplot(aes(x = time, y = value, color = unit)) +
geom_line()
data_monthly %>%
ggplot(aes(x = time, y = value, color = unit)) +
geom_line() +
geom_vline(xintercept = 116)
df = readRDS("./data/bond/bond_116.Rds")
View(df)
df = readRDS("./data/bond/bond_116.Rds")[[106]]
View(df)
plot(ts(df$res.synth.target.raw$value))
lines(df$res.synth.target.raw$synthetic, col = "blue", lty = "l")
lines(1:155,df$res.synth.target.raw$synthetic, col = "blue", lty = "l")
lines(1:155,df$res.synth.target.raw$synthetic, col = "blue")
line(1:155,df$res.synth.target.raw$synthetic, col = "blue")
plot(ts(df$res.synth.target.raw$value))
lines(1:155,df$res.synth.target.raw$synthetic, col = "blue")
rbind(data.frame(time = 1:155,
value = df$res.synth.target.raw$value,
unit = "value"),
data.frame(time = 1:155,
value = df$res.synth.target.raw$synthetic,
unit = "sc"),
data.frame(time = 1:155,
value = df$res.synth.target.TFDTW$synthetic,
unit = "dsc"))
rbind(data.frame(time = 1:155,
value = df$res.synth.target.raw$value,
unit = "value"),
data.frame(time = 1:155,
value = df$res.synth.target.raw$synthetic,
unit = "sc"),
data.frame(time = 1:155,
value = df$res.synth.target.TFDTW$synthetic,
unit = "dsc")) %>%
ggplot(aes(x = time, y = value, color = unit)) %>%
geom_line()  +
geom_vline(xintercept = 116)
rbind(data.frame(time = 1:155,
value = df$res.synth.target.raw$value,
unit = "value"),
data.frame(time = 1:155,
value = df$res.synth.target.raw$synthetic,
unit = "sc"),
data.frame(time = 1:155,
value = df$res.synth.target.TFDTW$synthetic,
unit = "dsc")) %>%
ggplot(aes(x = time, y = value, color = unit)) +
geom_line()  +
geom_vline(xintercept = 116)
df = readRDS("./data/bond/bond_104.Rds")[[141]]
rbind(data.frame(time = 1:155,
value = df$res.synth.target.raw$value,
unit = "value"),
data.frame(time = 1:155,
value = df$res.synth.target.raw$synthetic,
unit = "sc"),
data.frame(time = 1:155,
value = df$res.synth.target.TFDTW$synthetic,
unit = "dsc")) %>%
ggplot(aes(x = time, y = value, color = unit)) +
geom_line()  +
geom_vline(xintercept = 116)
mse = results %>%
filter(unit == "INXG.L") %>%
group_by(file) %>%
filter(mse.preT.TFDTW == min(mse.preT.TFDTW)) %>%
filter(id == min(id))
mse = results %>%
filter(unit == "TIP") %>%
group_by(file) %>%
filter(mse.preT.TFDTW == min(mse.preT.TFDTW)) %>%
filter(id == min(id))
mse = results %>%
filter(unit == "XRB.TO") %>%
group_by(file) %>%
filter(mse.preT.TFDTW == min(mse.preT.TFDTW)) %>%
filter(id == min(id))
View(results2)
mse = results %>%
filter(unit == "IBCI.DE")
mse = results %>%
filter(unit == "IBCI.DE") %>%
group_by(file) %>%
filter(mse.preT.TFDTW == min(mse.preT.TFDTW)) %>%
filter(id == min(id))
View(results)
View(data)
View(data_monthly)
df = readRDS("./data/bond/bond_99.Rds")[[123]]
View(df)
rbind(data.frame(time = 1:155,
value = df$results.TFDTW.synth$TIP$res.synth.raw$value,
unit = "value"),
data.frame(time = 1:155,
value = df$results.TFDTW.synth$TIP$res.synth.raw$synthetic,
unit = "sc"),
data.frame(time = 1:155,
value = df$results.TFDTW.synth$TIP$res.synth.TFDTW$synthetic,
unit = "dsc")) %>%
ggplot(aes(x = time, y = value, color = unit)) +
geom_line()  +
geom_vline(xintercept = 99)
## Results ---------------------------------------------------------------------
folder = "./data/bond/"
file.list = list.files(folder)
file = file.list[[1]]
file
df = readRDS(paste0(folder, file))
item = df[[1]]
View(item)
View(item[["mse"]])
View(item[["mse"]])
i = 1
item$mse$unit
i = "IBCI.DE"
strsplit(file, "[.]")
strsplit(strsplit(file, "[.]")[[1]][1], "_")[[1]][2]
as.numeric(strsplit(strsplit(file, "[.]")[[1]][1], "_")[[1]][2])
treat_time:(treat_time + 23)
treat_time = as.numeric(strsplit(strsplit(file, "[.]")[[1]][1], "_")[[1]][2])
treat_time:(treat_time + 23)
(item$results.TFDTW.synth[[i]]$res.synth.raw$synthetic -
item$results.TFDTW.synth[[i]]$res.synth.TFDTW$synthetic)[treat_time:(treat_time + 23)]
difference = (item$results.TFDTW.synth[[i]]$res.synth.raw$synthetic -
item$results.TFDTW.synth[[i]]$res.synth.TFDTW$synthetic)
msd = mean((difference[treat_time:(treat_time + 23)])^2, na.rm = TRUE)
msd
results = NULL
treat_time = as.numeric(strsplit(strsplit(file, "[.]")[[1]][1], "_")[[1]][2])
mse = future_map2(
as.list(1:length(df)),
df,
~{
id = .x
item = .y
item$mse$id = id
item$mse$diff = 0
for (i in 1:4) {
unit = item$mse$unit[i]
difference = (item$results.TFDTW.synth[[unit]]$res.synth.raw$synthetic -
item$results.TFDTW.synth[[unit]]$res.synth.TFDTW$synthetic)
msd = mean((difference[treat_time:(treat_time + 23)])^2, na.rm = TRUE)
item$mse$diff[i] = msd
}
item$mse
}
) %>%
do.call("rbind", .)
View(mse)
## Results ---------------------------------------------------------------------
folder = "./data/bond/"
file.list = list.files(folder)
results = NULL
for (file in file.list) {
print(file)
df = readRDS(paste0(folder, file))
treat_time = as.numeric(strsplit(strsplit(file, "[.]")[[1]][1], "_")[[1]][2])
mse = future_map2(
as.list(1:length(df)),
df,
~{
id = .x
item = .y
item$mse$id = id
item$mse$diff = 0
for (i in 1:4) {
unit = item$mse$unit[i]
difference = (item$results.TFDTW.synth[[unit]]$res.synth.raw$synthetic -
item$results.TFDTW.synth[[unit]]$res.synth.TFDTW$synthetic)
msd = mean((difference[treat_time:(treat_time + 23)])^2, na.rm = TRUE)
item$mse$diff[i] = msd
}
item$mse
}
) %>%
do.call("rbind", .)
mse$file = file
results[[file]] = mse
}
results = results %>%
do.call("rbind", .) %>%
`rownames<-`(NULL)
View(results)
mse = results %>%
filter(unit == "IBCI.DE") %>%
group_by(file) %>%
filter(mse.preT.TFDTW == min(mse.preT.TFDTW)) %>%
filter(id == min(id))
View(mse)
df = readRDS("./data/bond/bond_29.Rds")[[145]]
rbind(data.frame(time = 1:155,
value = df$res.synth.target.raw$value,
unit = "value"),
data.frame(time = 1:155,
value = df$res.synth.target.raw$synthetic,
unit = "sc"),
data.frame(time = 1:155,
value = df$res.synth.target.TFDTW$synthetic,
unit = "dsc")) %>%
ggplot(aes(x = time, y = value, color = unit)) +
geom_line()  +
geom_vline(xintercept = 29)
df = readRDS("./data/bond/bond_26.Rds")[[145]]
rbind(data.frame(time = 1:155,
value = df$res.synth.target.raw$value,
unit = "value"),
data.frame(time = 1:155,
value = df$res.synth.target.raw$synthetic,
unit = "sc"),
data.frame(time = 1:155,
value = df$res.synth.target.TFDTW$synthetic,
unit = "dsc")) %>%
ggplot(aes(x = time, y = value, color = unit)) +
geom_line()  +
geom_vline(xintercept = 29)
mse = results %>%
filter(unit == "TIP") %>%
group_by(file) %>%
filter(mse.preT.TFDTW == min(mse.preT.TFDTW)) %>%
filter(id == min(id))
df = readRDS("./data/bond/bond_111.Rds")[[75]]
rbind(data.frame(time = 1:155,
value = df$results.TFDTW.synth$TIP$res.synth.raw$value,
unit = "value"),
data.frame(time = 1:155,
value = df$results.TFDTW.synth$TIP$res.synth.raw$synthetic,
unit = "sc"),
data.frame(time = 1:155,
value = df$results.TFDTW.synth$TIP$res.synth.TFDTW$synthetic,
unit = "dsc")) %>%
ggplot(aes(x = time, y = value, color = unit)) +
geom_line()  +
geom_vline(xintercept = 111)
rbind(data.frame(time = 1:155,
value = df$results.TFDTW.synth$TIP$res.synth.raw$value -
df$results.TFDTW.synth$TIP$res.synth.raw$synthetic,
unit = "sc"),
data.frame(time = 1:155,
value = df$results.TFDTW.synth$TIP$res.synth.raw$value -
df$results.TFDTW.synth$TIP$res.synth.TFDTW$synthetic,
unit = "dsc")) %>%
ggplot(aes(x = time, y = value, color = unit)) +
geom_line()  +
geom_vline(xintercept = 111)
df = readRDS("./data/bond/bond_102.Rds")[[75]]
rbind(data.frame(time = 1:155,
value = df$results.TFDTW.synth$TIP$res.synth.raw$value -
df$results.TFDTW.synth$TIP$res.synth.raw$synthetic,
unit = "sc"),
data.frame(time = 1:155,
value = df$results.TFDTW.synth$TIP$res.synth.raw$value -
df$results.TFDTW.synth$TIP$res.synth.TFDTW$synthetic,
unit = "dsc")) %>%
ggplot(aes(x = time, y = value, color = unit)) +
geom_line()  +
geom_vline(xintercept = 102)
df = readRDS("./data/bond/bond_110.Rds")[[75]]
rbind(data.frame(time = 1:155,
value = df$results.TFDTW.synth$TIP$res.synth.raw$value -
df$results.TFDTW.synth$TIP$res.synth.raw$synthetic,
unit = "sc"),
data.frame(time = 1:155,
value = df$results.TFDTW.synth$TIP$res.synth.raw$value -
df$results.TFDTW.synth$TIP$res.synth.TFDTW$synthetic,
unit = "dsc")) %>%
ggplot(aes(x = time, y = value, color = unit)) +
geom_line()  +
geom_vline(xintercept = 110)
mse = results %>%
filter(unit == "INXG.L") %>%
group_by(file) %>%
filter(mse.preT.TFDTW == min(mse.preT.TFDTW)) %>%
filter(id == min(id))
rbind(data.frame(time = 1:155,
value = df$results.TFDTW.synth$INXG.L$res.synth.raw$value -
df$results.TFDTW.synth$INXG.L$res.synth.raw$synthetic,
unit = "sc"),
data.frame(time = 1:155,
value = df$results.TFDTW.synth$INXG.L$res.synth.raw$value -
df$results.TFDTW.synth$INXG.L$res.synth.TFDTW$synthetic,
unit = "dsc")) %>%
ggplot(aes(x = time, y = value, color = unit)) +
geom_line()  +
geom_vline(xintercept = 117)
df = readRDS("./data/bond/bond_110.Rds")[[75]]
rbind(data.frame(time = 1:155,
value = df$results.TFDTW.synth$TIP$res.synth.raw$value -
df$results.TFDTW.synth$TIP$res.synth.raw$synthetic,
unit = "sc"),
data.frame(time = 1:155,
value = df$results.TFDTW.synth$TIP$res.synth.raw$value -
df$results.TFDTW.synth$TIP$res.synth.TFDTW$synthetic,
unit = "dsc")) %>%
ggplot(aes(x = time, y = value, color = unit)) +
geom_line()  +
geom_vline(xintercept = 110)
View(data)
View(data_monthly)
## Setup -----------------------------------------------------------------------
library(checkpoint)
checkpoint("2022-04-01")
library(parallel)
n.cores = detectCores()
library(tidyverse)
library(furrr)
plan(multisession, workers = n.cores - 1)
options(future.rng.onMisuse="ignore")
options(stringsAsFactors = FALSE)
source("./R/utility/misc.R")
source("./R/utility/TFDTW.R")
source("./R/utility/synth.R")
source("./R/utility/implement.R")
source("./R/utility/grid.search.R")
set.seed(20220407)
